<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Mishmish Admin - Elite Control ğŸ‘‘</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <style>
        :root { --mish: #f472b6; --bg: #0f172a; --panel: #1e293b; --admin-blue: #3797f0; }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; font-family: 'Segoe UI', sans-serif; }
        body { background: var(--bg); color: white; margin: 0; height: 100vh; overflow: hidden; position: fixed; width: 100%; }

        /* Ø§Ù„Ù‡ÙŠØ¯Ø± Ø§Ù„Ø£ØµÙ„ÙŠ Ø¨ØªÙ†Ø³ÙŠÙ‚ Ù…Ø´Ù…Ø´ */
        #header-fixed { position: fixed; top: 0; width: 100%; height: 115px; background: var(--panel); z-index: 1000; border-bottom: 2px solid var(--admin-blue); }
        .marquee { height: 38px; background: rgba(0,0,0,0.5); overflow: hidden; position: relative; display: flex; align-items: center; }
        .marquee-inner { position: absolute; white-space: nowrap; animation: scroll-left-right 35s linear infinite; }
        @keyframes scroll-left-right { 0% { left: -100%; } 100% { left: 100%; } }
        .quote-item { margin: 0 35px; font-weight: 900; font-size: 17px; color: var(--mish); display: inline-flex; align-items: center; gap: 8px; }

        .status-bar { display: flex; align-items: center; justify-content: space-between; padding: 10px 15px; height: 77px; }
        .avatar-box { width: 55px; height: 55px; border-radius: 50%; border: 2.5px solid var(--admin-blue); position: relative; cursor: pointer; }
        .has-story { box-shadow: 0 0 15px 4px var(--mish); border-color: #fff; }

        /* Ù…Ù†Ø·Ù‚Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø¨Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ */
        #chat-flow { position: absolute; top: 115px; bottom: 90px; width: 100%; overflow-y: auto; padding: 15px; display: flex; flex-direction: column; gap: 15px; }
        .bubble { padding: 14px; border-radius: 22px; max-width: 85%; font-size: 15px; position: relative; animation: fadeIn 0.3s; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
        
        .mish-style { align-self: flex-start; background: #262f40; border-radius: 20px 20px 20px 5px; border-right: 4px solid var(--mish); }
        .adm-style { align-self: flex-end; background: var(--admin-blue); color: white; border-radius: 20px 20px 5px 20px; }
        
        .bubble img { width: 100%; border-radius: 12px; margin-bottom: 8px; }
        
        /* Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ù…Ø¯ÙŠØ± Ø¯Ø§Ø®Ù„ Ø§Ù„ÙÙ‚Ø§Ø¹Ø© */
        .admin-actions { display: flex; gap: 10px; margin-top: 10px; border-top: 1px solid rgba(255,255,255,0.1); padding-top: 8px; }
        .action-btn { background: none; border: none; color: #94a3b8; font-size: 12px; font-weight: bold; cursor: pointer; padding: 5px; }
        .action-btn:hover { color: white; }
        .del-btn { color: #f87171; }

        /* Ø´Ø±ÙŠØ· Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ */
        #footer-fixed { position: fixed; bottom: 0; width: 100%; height: 90px; background: var(--bg); display: flex; align-items: center; justify-content: center; padding: 0 10px; }
        .input-container { flex: 1; background: #262f40; border-radius: 35px; display: flex; align-items: center; padding: 5px 15px; border: 1px solid #3e4a5d; height: 52px; }
        .input-container input { flex: 1; background: none; border: none; color: white; outline: none; font-size: 15px; }
        .send-btn { color: var(--admin-blue); font-weight: bold; background: none; border: none; margin-right: 10px; cursor: pointer; }

        /* Ø§Ù„Ù„ÙˆØ­Ø© Ø§Ù„Ø³ÙÙ„ÙŠØ© Ù„Ù„Ø®ÙŠØ§Ø±Ø§Øª */
        .sheet-overlay { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.85); z-index: 2000; align-items: flex-end; }
        .bottom-sheet { background: #1c2535; width: 100%; border-radius: 25px 25px 0 0; padding: 25px; transform: translateY(100%); transition: 0.3s; }
        .bottom-sheet.show { transform: translateY(0); }
        .sheet-btn { width: 100%; background: #262f40; border: none; color: white; padding: 16px; border-radius: 15px; margin-bottom: 10px; font-weight: bold; display: flex; align-items: center; gap: 12px; cursor: pointer; }
    </style>
</head>
<body>

<div id="header-fixed">
    <div class="marquee"><div class="marquee-inner" id="q-box"></div></div>
    <div class="status-bar">
        <div style="display:flex; align-items:center; gap:12px;">
            <div class="avatar-box" id="avatar-main" onclick="openAdminSheet()">
                <img id="p-img" src="" style="display:none; width:100%; height:100%; border-radius:50%; object-fit:cover;">
                <span id="p-ltr" style="line-height:55px; font-weight:900; font-size:22px; width:100%; display:block; text-align:center;">A</span>
            </div>
            <div>
                <div style="font-weight:bold; font-size:16px;">Ù…Ø±Ø­Ø¨Ø§ Ø¹Ø¨ÙˆØ¯ Ø§Ù„Ù…Ù„Ùƒ ğŸ‘‘</div>
                <div style="font-size:11px; color:var(--admin-blue);">Ù„ÙˆØ­Ø© Ø§Ù„Ø³ÙŠØ·Ø±Ø© Ù…ØªØµÙ„Ø©</div>
            </div>
        </div>
        <button onclick="openAdminSheet()" style="background:none; border:none; color:white; font-size:22px;"><i class="fas fa-sliders-h"></i></button>
    </div>
</div>

<div id="chat-flow"></div>

<div id="footer-fixed">
    <div class="input-container">
        <input type="text" id="msg-input" placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„Ø© ÙƒÙ…Ø¯ÙŠØ±...">
        <button class="send-btn" onclick="sendMsg()">Ø¥Ø±Ø³Ø§Ù„</button>
    </div>
</div>

<div class="sheet-overlay" id="p-overlay" onclick="closeSheets()">
    <div class="bottom-sheet" id="p-sheet" onclick="event.stopPropagation()">
        <div style="width:40px; height:5px; background:#4a5568; border-radius:10px; margin:0 auto 20px;"></div>
        
        <button class="sheet-btn" onclick="document.getElementById('p-upload').click()"><i class="fas fa-user-edit"></i> ØªØºÙŠÙŠØ± Ø¨Ø±ÙˆÙØ§ÙŠÙ„ Ù…Ø´Ù…Ø´</button>
        <input type="file" id="p-upload" style="display:none" onchange="uploadFile(this, 'profile')">
        
        <button class="sheet-btn" onclick="document.getElementById('story-upload').click()"><i class="fas fa-camera-retro"></i> ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ù…Ø´Ù…Ø´ (Ø³ØªÙˆØ±ÙŠ)</button>
        <input type="file" id="story-upload" style="display:none" onchange="uploadFile(this, 'story')">
        
        <button class="sheet-btn" onclick="changeQuotes()"><i class="fas fa-pen-fancy"></i> ØªØ¹Ø¯ÙŠÙ„ Ø´Ø±ÙŠØ· Ø§Ù„Ø¬Ù…Ù„</button>
        
        <button class="sheet-btn" style="background:#450a0a; color:#f87171;" onclick="resetChat()"><i class="fas fa-fire"></i> Ù…Ø³Ø­ ÙƒØ§ÙØ© Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ (ØªØµÙÙŠØ±)</button>
    </div>
</div>

<script>
    // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ÙØ§ÙŠØ±Ø¨ÙŠØ³ (ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ)
    const config = { databaseURL: "https://ourphotoshare-a874a-default-rtdb.firebaseio.com" };
    firebase.initializeApp(config); const db = firebase.database();

    // Ø¬Ù„Ø¨ ÙˆØ¹Ø±Ø¶ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„
    db.ref('comments').on('value', snap => {
        const box = document.getElementById('chat-flow'); box.innerHTML = "";
        snap.forEach(c => {
            const m = c.val(); const key = c.key;
            const div = document.createElement('div');
            div.className = `bubble ${m.isAdmin ? 'adm-style' : 'mish-style'}`;
            
            let content = m.type === 'image' ? `<img src="${m.data}">` : `<p style="margin:0">${m.text || m}</p>`;
            let replyTag = m.reply ? `<div style="font-size:11px; color:#4ade80; margin-top:8px; border-top:1px solid rgba(255,255,255,0.1); padding-top:5px;"><b>Ø±Ø¯Ùƒ:</b> ${m.reply}</div>` : '';
            
            div.innerHTML = `
                ${content}
                ${replyTag}
                <div class="admin-actions">
                    <button class="action-btn" onclick="replyMsg('${key}')"><i class="fas fa-reply"></i> Ø±Ø¯</button>
                    <button class="action-btn del-btn" onclick="deleteMsg('${key}')"><i class="fas fa-trash"></i> Ø­Ø°Ù</button>
                </div>
            `;
            box.appendChild(div);
        });
        box.scrollTop = box.scrollHeight;
    });

    // ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ø³ÙŠØ·Ø±Ø©
    function sendMsg() {
        const inp = document.getElementById('msg-input');
        if(inp.value.trim()) {
            db.ref('comments').push({ text: inp.value, isAdmin: true, time: Date.now() });
            inp.value = "";
        }
    }

    function replyMsg(id) {
        const txt = prompt("Ø§ÙƒØªØ¨ Ø§Ù„Ø±Ø¯ Ø§Ù„Ø°ÙŠ Ø³ÙŠØ¸Ù‡Ø± Ù„Ù„Ø¬Ù…ÙŠØ¹:");
        if(txt) db.ref('comments/'+id).update({ reply: txt });
    }

    function deleteMsg(id) {
        if(confirm("Ø­Ø°Ù Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹ØŸ")) db.ref('comments/'+id).remove();
    }

    function resetChat() {
        if(confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ØŸ Ø³ÙŠØªÙ… Ø­Ø°Ù ÙƒÙ„ ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¯Ø±Ø¯Ø´Ø©!")) db.ref('comments').remove();
    }

    function changeQuotes() {
        const q = prompt("Ø£Ø¯Ø®Ù„ Ø§Ù„Ø¬Ù…Ù„ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© (Ø§ÙØµÙ„ Ø¨ÙŠÙ†Ù‡Ø§ Ø¨Ù€ Ø¹Ù„Ø§Ù…Ø© - )");
        if(q) db.ref('mish_quotes').set(q.split("-"));
    }

    // Ø¬Ù„Ø¨ Ø§Ù„Ø¬Ù…Ù„ ÙˆØ§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„Ù…Ø¹Ø§ÙŠÙ†Ø©
    db.ref('mish_quotes').on('value', s => {
        const list = s.val() || ["Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙŠØ§ Ù…Ø¯ÙŠØ± âœ¨"];
        document.getElementById('q-box').innerHTML = list.concat(list).map(x => `<span class="quote-item">${x} ğŸŒ¸</span>`).join("");
    });

    db.ref('mish_profile').on('value', s => {
        const d = s.val(); if(d && d !== "EMPTY") { document.getElementById('p-img').src = d; document.getElementById('p-img').style.display="block"; document.getElementById('p-ltr').style.display="none"; }
    });

    // Ø§Ù„Ø±ÙØ¹ ÙˆØ§Ù„Ù„ÙˆØ­Ø§Øª
    function uploadFile(input, mode) {
        const r = new FileReader(); r.onload = e => {
            if(mode==='profile') db.ref('mish_profile').set(e.target.result);
            else if(mode==='story') db.ref('mish_story_photo').set(e.target.result);
            closeSheets();
        }; r.readAsDataURL(input.files[0]);
    }

    function openAdminSheet() { document.getElementById('p-overlay').style.display='flex'; setTimeout(()=>document.getElementById('p-sheet').classList.add('show'),10); }
    function closeSheets() { document.querySelectorAll('.bottom-sheet').forEach(s=>s.classList.remove('show')); setTimeout(()=>document.querySelectorAll('.sheet-overlay').forEach(o=>o.style.display='none'),300); }
</script>
</body>
</html>
