<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Mishmish Admin - Elite Control ğŸ‘‘</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/hammer.js/2.0.8/hammer.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <style>
        :root { --mish: #f472b6; --bg: #0f172a; --panel: #1e293b; --admin-blue: #3797f0; }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; font-family: 'Segoe UI', sans-serif; }
        body { background: var(--bg); color: white; margin: 0; height: 100vh; overflow: hidden; position: fixed; width: 100%; }

        /* Ø§Ù„Ù‡ÙŠØ¯Ø± Ø§Ù„Ø£ØµÙ„ÙŠ */
        #header-fixed { position: fixed; top: 0; width: 100%; height: 115px; background: var(--panel); z-index: 1000; border-bottom: 1px solid rgba(255,255,255,0.1); }
        .marquee { height: 38px; background: rgba(0,0,0,0.5); overflow: hidden; position: relative; display: flex; align-items: center; }
        .marquee-inner { position: absolute; white-space: nowrap; animation: scroll-left-right 35s linear infinite; }
        @keyframes scroll-left-right { 0% { left: -100%; } 100% { left: 100%; } }
        .quote-item { margin: 0 35px; font-weight: 900; font-size: 17px; color: var(--mish); display: inline-flex; align-items: center; gap: 8px; }

        .status-bar { display: flex; align-items: center; justify-content: space-between; padding: 10px 15px; height: 77px; }
        .avatar-box { width: 55px; height: 55px; border-radius: 50%; border: 2.5px solid var(--mish); position: relative; cursor: pointer; }
        .has-story { box-shadow: 0 0 15px 4px var(--mish); border-color: #fff; }
        .avatar-box img { width: 100%; height: 100%; border-radius: 50%; object-fit: cover; }

        /* Ø§Ù„Ø¯Ø±Ø¯Ø´Ø© Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠØ© Ù…Ø¹ Ù…ÙŠØ²Ø§Øª Ø§Ù„Ø³ÙŠØ·Ø±Ø© */
        #chat-flow { position: absolute; top: 115px; bottom: 90px; width: 100%; overflow-y: auto; padding: 15px; display: flex; flex-direction: column; gap: 15px; }
        .bubble { padding: 12px 16px; border-radius: 22px; max-width: 82%; font-size: 15px; position: relative; cursor: pointer; }
        .mish-style { align-self: flex-start; background: #262f40; border-radius: 20px 20px 20px 5px; }
        .adm-style { align-self: flex-end; background: var(--admin-blue); color: white; border-radius: 20px 20px 5px 20px; }
        .bubble img { width: 100%; border-radius: 15px; display: block; margin-bottom: 5px; }
        
        /* Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ù…Ø¯ÙŠØ± Ø§Ù„Ù…Ø®ÙÙŠØ© ØªØ­Øª ÙƒÙ„ Ø±Ø³Ø§Ù„Ø© */
        .admin-tools { display: flex; gap: 10px; margin-top: 8px; border-top: 1px solid rgba(255,255,255,0.1); padding-top: 8px; }
        .tool-btn-sm { background: rgba(255,255,255,0.1); border: none; color: #ccc; font-size: 11px; padding: 4px 8px; border-radius: 5px; cursor: pointer; }
        .tool-btn-sm:hover { background: var(--mish); color: white; }

        /* Ø´Ø±ÙŠØ· Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø£ØµÙ„ÙŠ */
        #footer-fixed { position: fixed; bottom: 0; width: 100%; height: 90px; background: var(--bg); display: flex; align-items: center; justify-content: center; padding: 0 10px; }
        .insta-input-container { flex: 1; background: #262f40; border-radius: 35px; display: flex; align-items: center; padding: 5px 10px; border: 1px solid #3e4a5d; gap: 5px; height: 52px; }
        .insta-input-container input { flex: 1; background: none; border: none; color: white; padding: 10px 5px; outline: none; }
        .send-txt { color: var(--admin-blue); font-weight: bold; background: none; border: none; padding: 0 10px; cursor: pointer; }

        /* Ø§Ù„Ù„ÙˆØ­Ø© Ø§Ù„Ø³ÙÙ„ÙŠØ© Ù„Ù„Ø³ÙŠØ·Ø±Ø© Ø§Ù„Ø´Ø§Ù…Ù„Ø© */
        .sheet-overlay { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.85); z-index: 2000; align-items: flex-end; }
        .bottom-sheet { background: #1c2535; width: 100%; border-radius: 25px 25px 0 0; padding: 20px; transform: translateY(100%); transition: 0.3s; text-align: center; }
        .bottom-sheet.show { transform: translateY(0); }
        .sheet-btn { width: 100%; background: none; border: none; color: white; padding: 16px; font-size: 15px; border-bottom: 1px solid rgba(255,255,255,0.05); display: flex; align-items: center; gap: 15px; cursor: pointer; }
    </style>
</head>
<body>

<div id="header-fixed">
    <div class="marquee"><div class="marquee-inner" id="q-box"></div></div>
    <div class="status-bar">
        <div style="display:flex; align-items:center; gap:12px;">
            <div class="avatar-box" id="avatar-main" onclick="openAdminSheet()">
                <img id="p-img" src="" style="display:none">
                <span id="p-ltr" style="line-height:55px; font-weight:900; font-size:22px; width:100%; display:block; text-align:center;">Ù…</span>
            </div>
            <div>
                <div style="font-weight:bold;">Ø§Ù„Ù…Ø¯ÙŠØ± (Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„ÙƒØ§Ù…Ù„)</div>
                <div id="st-text" style="font-size:11px; color:var(--mish);">Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ÙˆØµÙˆÙ„: Ù…Ø¯ÙŠØ± Ø§Ù„Ù†Ø¸Ø§Ù… âš™ï¸</div>
            </div>
        </div>
        <button onclick="openAdminSheet()" style="background:none; border:none; color:white; font-size:22px;"><i class="fas fa-cog"></i></button>
    </div>
</div>

<div id="chat-flow"></div>

<div id="footer-fixed">
    <div class="insta-input-container">
        <button class="footer-icon" style="background:none; border:none; color:white; font-size:20px;" onclick="document.getElementById('chat-up').click()"><i class="fas fa-camera"></i></button>
        <input type="file" id="chat-up" style="display:none" onchange="uploadFile(this, 'chat')">
        <input type="text" id="msg-input" placeholder="ØªØ­Ø¯Ø« ÙƒÙ…Ø¯ÙŠØ±...">
        <button class="send-txt" onclick="sendMsg()">Ø¥Ø±Ø³Ø§Ù„</button>
    </div>
</div>

<div class="sheet-overlay" id="p-overlay" onclick="closeSheets()">
    <div class="bottom-sheet" id="p-sheet" onclick="event.stopPropagation()">
        <div style="width:40px; height:5px; background:#4a5568; border-radius:10px; margin:0 auto 20px;"></div>
        
        <button class="sheet-btn" onclick="resetEverything()" style="color:#ff4757"><i class="fas fa-sync-alt"></i> ØªØµÙÙŠØ± Ø§Ù„Ø¯Ø±Ø¯Ø´Ø© Ø¨Ø§Ù„ÙƒØ§Ù…Ù„</button>
        <button class="sheet-btn" onclick="document.getElementById('p-upload').click()"><i class="fas fa-user-circle"></i> ØªØºÙŠÙŠØ± Ø¨Ø±ÙˆÙØ§ÙŠÙ„ Ù…Ø´Ù…Ø´</button>
        <input type="file" id="p-upload" style="display:none" onchange="uploadFile(this, 'profile')">
        
        <button class="sheet-btn" onclick="document.getElementById('story-upload').click()"><i class="fas fa-plus-circle"></i> Ø¥Ø¶Ø§ÙØ© Ø­Ø§Ù„Ø© Ø¬Ø¯ÙŠØ¯Ø© Ù„Ù€ Ù…Ø´Ù…Ø´</button>
        <input type="file" id="story-upload" style="display:none" onchange="uploadFile(this, 'story')">
        
        <button class="sheet-btn" onclick="changeQuotes()"><i class="fas fa-edit"></i> ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¬Ù…Ù„ Ø§Ù„Ù…ØªØ­Ø±ÙƒØ©</button>
    </div>
</div>

<script>
    const config = { databaseURL: "https://ourphotoshare-a874a-default-rtdb.firebaseio.com" };
    firebase.initializeApp(config); const db = firebase.database();

    // 1. Ø¬Ù„Ø¨ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø¨Ù†ÙØ³ ØªÙ†Ø³ÙŠÙ‚ Ù…Ø´Ù…Ø´ ÙˆÙ„ÙƒÙ† Ù…Ø¹ Ø£Ø²Ø±Ø§Ø± (Ø­Ø°Ù ÙˆØ±Ø¯)
    db.ref('comments').on('value', snap => {
        const box = document.getElementById('chat-flow'); box.innerHTML = "";
        snap.forEach(c => {
            const m = c.val(); const key = c.key;
            const div = document.createElement('div');
            div.className = `bubble ${m.isAdmin ? 'adm-style' : 'mish-style'}`;
            
            let content = m.type === 'image' ? `<img src="${m.data}">` : `<p style="margin:0">${m.text || m}</p>`;
            let replyInfo = m.reply ? `<div style="font-size:11px; color:#22c55e; margin-top:5px; border-top:1px solid rgba(255,255,255,0.1); padding-top:4px;">âœ… ØªÙ… Ø§Ù„Ø±Ø¯: ${m.reply}</div>` : '';
            
            div.innerHTML = `
                ${content}
                ${replyInfo}
                <div class="admin-tools">
                    <button class="tool-btn-sm" onclick="replyMsg('${key}')">Ø±Ø¯</button>
                    <button class="tool-btn-sm" style="color:#ff4757" onclick="deleteMsg('${key}')">Ø­Ø°Ù</button>
                </div>
            `;
            box.appendChild(div);
        });
        box.scrollTop = box.scrollHeight;
    });

    // 2. ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ù…Ø¯ÙŠØ±
    function sendMsg() {
        const inp = document.getElementById('msg-input');
        if(inp.value.trim()) {
            db.ref('comments').push({ text: inp.value, isAdmin: true, time: Date.now() });
            inp.value = "";
        }
    }

    function replyMsg(id) {
        const txt = prompt("Ø§ÙƒØªØ¨ Ø±Ø¯Ùƒ Ø¹Ù„Ù‰ Ù‡Ø°Ù‡ Ø§Ù„Ø±Ø³Ø§Ù„Ø©:");
        if(txt) db.ref('comments/'+id).update({ reply: txt });
    }

    function deleteMsg(id) {
        if(confirm("Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„Ø±Ø³Ø§Ù„Ø©ØŸ")) db.ref('comments/'+id).remove();
    }

    function resetEverything() {
        if(confirm("ØªØµÙÙŠØ± Ø´Ø§Ù…Ù„ Ù„Ù„Ø¯Ø±Ø¯Ø´Ø©ØŸ")) db.ref('comments').remove();
    }

    function changeQuotes() {
        const q = prompt("Ø£Ø¯Ø®Ù„ Ø§Ù„Ø¬Ù…Ù„ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© (Ø§ÙØµÙ„ Ø¨ÙŠÙ†Ù‡Ø§ Ø¨Ù€ Ø¹Ù„Ø§Ù…Ø© - )");
        if(q) db.ref('mish_quotes').set(q.split("-"));
    }

    // 3. Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„ØµÙˆØ± ÙˆØ§Ù„Ø­Ø§Ù„Ø© (Ù„Ù„Ù…Ø¹Ø§ÙŠÙ†Ø©)
    db.ref('mish_profile').on('value', s => {
        const d = s.val(); if(d && d !== "EMPTY") { document.getElementById('p-img').src = d; document.getElementById('p-img').style.display="block"; document.getElementById('p-ltr').style.display="none"; }
    });

    db.ref('mish_story_photo').on('value', s => {
        if(s.val() && s.val() !== "EMPTY") document.getElementById('avatar-main').classList.add('has-story');
        else document.getElementById('avatar-main').classList.remove('has-story');
    });

    // Ø§Ù„Ø¬Ù…Ù„ Ø§Ù„Ù…ØªØ­Ø±ÙƒØ©
    db.ref('mish_quotes').on('value', s => {
        const list = s.val() || ["Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ ÙŠØ§ Ù…Ø¯ÙŠØ± Ø§Ù„Ù†Ø¸Ø§Ù… âœ¨"];
        document.getElementById('q-box').innerHTML = list.concat(list).map(x => `<span class="quote-item">${x} ğŸŒ¸</span>`).join("");
    });

    // Ø§Ù„Ø±ÙØ¹ ÙˆØ§Ù„Ù„ÙˆØ­Ø§Øª
    function uploadFile(input, mode) {
        const r = new FileReader(); r.onload = e => {
            if(mode==='chat') db.ref('comments').push({type:'image', data:e.target.result, isAdmin:true});
            else if(mode==='profile') db.ref('mish_profile').set(e.target.result);
            else if(mode==='story') db.ref('mish_story_photo').set(e.target.result);
            closeSheets();
        }; r.readAsDataURL(input.files[0]);
    }

    function openAdminSheet() { document.getElementById('p-overlay').style.display='flex'; setTimeout(()=>document.getElementById('p-sheet').classList.add('show'),10); }
    function closeSheets() { document.querySelectorAll('.bottom-sheet').forEach(s=>s.classList.remove('show')); setTimeout(()=>document.querySelectorAll('.sheet-overlay').forEach(o=>o.style.display='none'),300); }
</script>
</body>
                                                                                                                                                 </html>
