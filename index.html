<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Mishmish Admin Pro ğŸ‘‘</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <style>
        :root { --mish: #f472b6; --bg: #0f172a; --panel: #1e293b; --admin-blue: #3797f0; }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; font-family: 'Segoe UI', sans-serif; }
        body { background: var(--bg); color: white; margin: 0; height: 100vh; overflow: hidden; position: fixed; width: 100%; }

        /* Ø§Ù„Ù‡ÙŠØ¯Ø± */
        #header-fixed { position: fixed; top: 0; width: 100%; height: 115px; background: var(--panel); z-index: 1000; border-bottom: 2px solid var(--admin-blue); }
        .marquee { height: 38px; background: rgba(0,0,0,0.5); overflow: hidden; position: relative; display: flex; align-items: center; }
        .marquee-inner { position: absolute; white-space: nowrap; animation: scroll-left-right 35s linear infinite; }
        @keyframes scroll-left-right { 0% { left: -100%; } 100% { left: 100%; } }
        .quote-item { margin: 0 35px; font-weight: 900; font-size: 17px; color: var(--mish); }

        /* Ø§Ù„Ø¯Ø±Ø¯Ø´Ø© */
        #chat-flow { position: absolute; top: 115px; bottom: 90px; width: 100%; overflow-y: auto; padding: 15px; display: flex; flex-direction: column; gap: 15px; }
        .bubble { padding: 14px; border-radius: 22px; max-width: 85%; font-size: 15px; position: relative; }
        .mish-style { align-self: flex-start; background: #262f40; border-right: 4px solid var(--mish); }
        .adm-style { align-self: flex-end; background: var(--admin-blue); color: white; }
        audio { width: 100%; height: 35px; filter: invert(1); margin-top: 5px; }

        /* Ø´Ø±ÙŠØ· Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù…Ø·ÙˆØ± */
        #footer-fixed { position: fixed; bottom: 0; width: 100%; height: 90px; background: var(--bg); display: flex; align-items: center; padding: 0 10px; gap: 8px; }
        .input-container { flex: 1; background: #262f40; border-radius: 35px; display: flex; align-items: center; padding: 0 15px; border: 1px solid #3e4a5d; height: 50px; }
        .input-container input { flex: 1; background: none; border: none; color: white; outline: none; }
        .icon-btn { background: none; border: none; color: white; font-size: 20px; cursor: pointer; padding: 5px; transition: 0.3s; }
        .rec-active { color: #f87171; animation: pulse 1s infinite; }
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.5; } 100% { opacity: 1; } }

        /* Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¥ÙŠÙ…ÙˆØ¬ÙŠ */
        #emoji-box { display: none; position: absolute; bottom: 95px; left: 10px; background: #1c2535; border: 1px solid #3e4a5d; border-radius: 15px; padding: 10px; width: 250px; grid-template-columns: repeat(6, 1fr); gap: 5px; z-index: 2000; }
        .emoji-item { font-size: 22px; cursor: pointer; text-align: center; padding: 5px; }

        /* Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ù…Ø¯ÙŠØ± */
        .admin-actions { display: flex; gap: 10px; margin-top: 8px; border-top: 1px solid rgba(255,255,255,0.1); padding-top: 5px; }
        .act-btn { background: none; border: none; color: #94a3b8; font-size: 11px; cursor: pointer; font-weight: bold; }
    </style>
</head>
<body>

<div id="header-fixed">
    <div class="marquee"><div class="marquee-inner" id="q-box"></div></div>
    <div class="status-bar" style="display:flex; align-items:center; justify-content:space-between; padding:10px 15px;">
        <div style="font-weight:bold;">Ø§Ù„Ù…Ø¯ÙŠØ± (ØµÙˆØª + Ø¥ÙŠÙ…ÙˆØ¬ÙŠ) ğŸ‘‘</div>
        <button onclick="openAdminSheet()" style="background:none; border:none; color:white; font-size:22px;"><i class="fas fa-cog"></i></button>
    </div>
</div>

<div id="chat-flow"></div>

<div id="emoji-box"></div>

<div id="footer-fixed">
    <button class="icon-btn" onclick="toggleEmoji()"><i class="far fa-smile"></i></button>
    <div class="input-container">
        <input type="text" id="msg-input" placeholder="Ø§ÙƒØªØ¨ ÙƒÙ…Ø¯ÙŠØ±...">
        <button class="icon-btn" style="color:var(--admin-blue)" onclick="sendMsg()"><i class="fas fa-paper-plane"></i></button>
    </div>
    <button class="icon-btn" id="mic-btn" onclick="toggleRecording()"><i class="fas fa-microphone"></i></button>
</div>

<script>
    const config = { databaseURL: "https://ourphotoshare-a874a-default-rtdb.firebaseio.com" };
    firebase.initializeApp(config); const db = firebase.database();

    // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¥ÙŠÙ…ÙˆØ¬ÙŠ
    const emojis = ["ğŸŒ¸","âœ¨","ğŸ‘‘","â¤ï¸","ğŸ˜‚","ğŸ˜","ğŸ”¥","ğŸ™Œ","â­","ğŸ¬","ğŸŒ¹","ğŸˆ"];
    const eBox = document.getElementById('emoji-box');
    emojis.forEach(e => {
        let span = document.createElement('span'); span.className = 'emoji-item'; span.innerText = e;
        span.onclick = () => { document.getElementById('msg-input').value += e; eBox.style.display = 'none'; };
        eBox.appendChild(span);
    });
    function toggleEmoji() { eBox.style.display = eBox.style.display === 'grid' ? 'none' : 'grid'; }

    // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø§Ù„ØµÙˆØªÙŠ
    let mediaRecorder; let audioChunks = [];
    async function toggleRecording() {
        const btn = document.getElementById('mic-btn');
        if (!mediaRecorder || mediaRecorder.state === "inactive") {
            const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
            mediaRecorder = new MediaRecorder(stream);
            mediaRecorder.ondataavailable = e => audioChunks.push(e.data);
            mediaRecorder.onstop = async () => {
                const audioBlob = new Blob(audioChunks, { type: 'audio/mp3' });
                const reader = new FileReader();
                reader.onloadend = () => {
                    db.ref('comments').push({ type: 'audio', data: reader.result, isAdmin: true, time: Date.now() });
                };
                reader.readAsDataURL(audioBlob);
                audioChunks = [];
            };
            mediaRecorder.start();
            btn.classList.add('rec-active');
        } else {
            mediaRecorder.stop();
            btn.classList.remove('rec-active');
        }
    }

    // Ø¹Ø±Ø¶ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ ÙˆØ§Ù„Ø±Ø¯ ÙˆØ§Ù„Ø­Ø°Ù
    db.ref('comments').on('value', snap => {
        const box = document.getElementById('chat-flow'); box.innerHTML = "";
        snap.forEach(c => {
            const m = c.val(); const key = c.key;
            const div = document.createElement('div');
            div.className = `bubble ${m.isAdmin ? 'adm-style' : 'mish-style'}`;
            
            let content = "";
            if(m.type === 'audio') content = `<audio src="${m.data}" controls></audio>`;
            else if(m.type === 'image') content = `<img src="${m.data}" style="width:100%; border-radius:12px;">`;
            else content = `<p style="margin:0">${m.text || m}</p>`;

            div.innerHTML = `${content}
                <div class="admin-actions">
                    <button class="act-btn" onclick="replyMsg('${key}')">Ø±Ø¯</button>
                    <button class="act-btn" style="color:#ff4757" onclick="deleteMsg('${key}')">Ø­Ø°Ù</button>
                </div>
                ${m.reply ? `<div style="font-size:11px; color:#4ade80; margin-top:5px;"><b>Ø±Ø¯Ùƒ:</b> ${m.reply}</div>` : ''}`;
            box.appendChild(div);
        });
        box.scrollTop = box.scrollHeight;
    });

    function sendMsg() {
        const inp = document.getElementById('msg-input');
        if(inp.value.trim()) {
            db.ref('comments').push({ text: inp.value, isAdmin: true, time: Date.now() });
            inp.value = "";
        }
    }

    function replyMsg(id) {
        const txt = prompt("Ø§ÙƒØªØ¨ Ø§Ù„Ø±Ø¯:");
        if(txt) db.ref('comments/'+id).update({ reply: txt });
    }

    function deleteMsg(id) { if(confirm("Ø­Ø°ÙØŸ")) db.ref('comments/'+id).remove(); }

    // Ø§Ù„Ø¬Ù…Ù„ Ø§Ù„Ù…ØªØ­Ø±ÙƒØ©
    const qList = ["Ù„ÙˆØ­Ø© Ø¥Ø¯Ø§Ø±Ø© Ù…Ø´Ù…Ø´ Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠØ© ğŸ‘‘", "Ø³Ø¬Ù„ ØµÙˆØªÙƒ Ù„ÙŠØ±Ø­Ø¨ Ø¨Ø§Ù„Ø¬Ù…ÙŠØ¹ ğŸ¤", "ØªØ­ÙƒÙ… Ø¨ÙƒÙ„ Ø´ÙŠØ¡ Ù…Ù† Ù‡Ù†Ø§ âœ¨"];
    document.getElementById('q-box').innerHTML = qList.concat(qList).map(x => `<span class="quote-item">${x}</span>`).join("");
</script>
</body>
</html>
